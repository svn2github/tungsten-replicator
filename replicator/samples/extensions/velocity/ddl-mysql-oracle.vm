#*
  Tungsten Scale-Out Stack
  Copyright (C) 2007-2013 Continuent Inc.
  Contact: tungsten@continuent.org
 
  Initial developer(s): Linas Virbalas
  Contributor(s):
 
  Velocity template for Tungsten.
  
  Transforms MySQL table definition (DDL) to Oracle dialect. Reports errors
  (ERROR) and warnings (WARN).
  
*### Counting tables.
#if ( !$counter )
  #set ( $counter = 1 )
#else
  #set( $counter = $counter + 1 )
#end
## Print header above the first table.
#if ( $counter == 1 )
/*
SQL generated on $date by ./ddlscan utility of Tungsten

url = $url
user = $user
dbName = $dbName
*/
#end

CREATE TABLE ##
$table.getName()##
#if ( $table.getName().length() > 30 ) /* ERROR: table name exceeds 30 characters, use rename option and a filter */ #end
#if ( $reservedWordsOracle.contains($table.getName().toUpperCase()) ) /* ERROR: table name is a reserved word, use rename option and a filter */ #end

(
## Columns.
#foreach ( $col in $table.getAllColumns() )
#set ( $colTruncated = false )
#set ( $colReserved = false )
#if ( $col.getName().length() > 30 )
#set ( $colTruncated = true )
  $col.getName().substring(0, 30) ##
#else
#if ( $reservedWordsOracle.contains($col.getName().toUpperCase()) )
#set ( $colReserved = true )
  $col.getName()_ ##
#else
  $col.getName() ##
#end
#end
#if ( $col.getTypeDescription().contains("DATE") || $col.getTypeDescription().contains("TIME") )
DATE##
#elseif ( $col.getTypeDescription().startsWith("BIGINT") )
NUMBER(19, 0)##
#elseif ( $col.getTypeDescription().startsWith("TINYINT") )
NUMBER(3, 0)##
#elseif ( $col.getTypeDescription().startsWith("SMALLINT") )
NUMBER(5, 0)##
#elseif ( $col.getTypeDescription().startsWith("MEDIUMINT") )
NUMBER(7, 0)##
#elseif ( $col.getTypeDescription().startsWith("INT") )
NUMBER(10, 0)##
#elseif ( $col.getTypeDescription().startsWith("VARCHAR") )
#if ( $col.getLength() <= 4000 )
VARCHAR2($col.getLength())##
#{else}CLOB /* WARN: too long ($col.getLength()) for Oracle VARCHAR2, using CLOB instead */##
#end
#elseif ( $col.getTypeDescription().startsWith("CHAR") )
$col.getTypeDescription()##
#elseif ( $col.getTypeDescription().contains("TEXT") )## TINYTEXT, TEXT, MEDIUMTEXT, LONGTEXT
CLOB##
#elseif ( $col.getTypeDescription().contains("FLOAT") )
$col.getTypeDescription()##
#elseif ( $col.getTypeDescription().startsWith("ENUM") )
VARCHAR2($enum.largestElementLen($col.getTypeDescription())) /* $col.getTypeDescription() */##
#else
$col.getTypeDescription() /* ERROR: unrecognized (type=$col.getType(), length=$col.getLength()) */#end##
#if( $colTruncated ) /* WARN: truncated column name exceeding 30 characters ($col.getName()) */#end##
#if( $colReserved ) /* WARN: changed column name because of reserved word ($col.getName()) */#end##
#if( $foreach.hasNext || $table.getPrimaryKey() ),#end

#end
## Primary key.
#if ( $table.getPrimaryKey() )
  PRIMARY KEY (##
#foreach ( $key in $table.getPrimaryKey().getColumns() )
$key.getName()##
#if( $foreach.hasNext ), #else)#end
#end
#else

  /* ERROR: table must have a primary key! */##
#end

);
