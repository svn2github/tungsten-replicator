#*
  Tungsten Scale-Out Stack
  Copyright (C) 2013 Continuent Inc.
  Contact: tungsten@continuent.org
 
  Initial developer(s): Linas Virbalas, Robert Hodges
  Contributor(s):
 
  Velocity template for Tungsten.

*##parse("includes/table-counter.vm")
## Print header or help above the first table.
#if ( $counter == 1 )
#if( $help )
Transforms MySQL table definition (DDL) to equivalent Redshift staging
tables. Reports errors (ERROR) and warnings (WARN). Column mappings
generally map to those used by Tungsten Replicator.

Options:
  -opt schemaPrefix prefix - prefix to add to schema name
                             (default - no prefix)
  -opt tablePrefix prefix  - prefix to add to table names
                             (default: stage_xxx_)
#else
#parse("includes/ddl-header.vm")
#end
#end
## Stop processing if help requested.
#if( $help )
#stop
#end

## Set defaul prefix values.
#if ( !$schemaPrefix )
#set ( $schemaPrefix = "" )
#end
#if( !$tablePrefix )
#set ( $tablePrefix = "stage_xxx_" )
#end
$table.setSchema($schemaPrefix.concat($table.getSchema()))## 
$table.setTable($tablePrefix.concat($table.getName()))##
#if ( $counter == 1 )
CREATE SCHEMA ${table.getSchema()};

#end
## Tungsten transaction identification columns.
#set ( $customColumns = "  tungsten_opcode CHAR(2),
  tungsten_seqno INT,
  tungsten_row_id INT,
  tungsten_commit_timestamp TIMESTAMP," )
#parse("includes/ddl-mysql-redshift-table.vm") 
## Primary key of this staging table.
,
  PRIMARY KEY (tungsten_opcode, tungsten_seqno, tungsten_row_id)
);
